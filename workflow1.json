{
  "name": "LegisAI",
  "nodes": [
    {
      "parameters": {
        "model": "sonar-pro",
        "messages": {
          "message": [
            {
              "content": "={{ $json.strict_character }}\n\n{{ $json.definite1 }}1{{ $json.definite2 }}\n\n{{ $json.strict_tone }}"
            }
          ]
        },
        "simplify": true,
        "options": {},
        "requestOptions": {}
      },
      "type": "n8n-nodes-base.perplexity",
      "typeVersion": 1,
      "position": [
        0,
        0
      ],
      "id": "02364154-d15f-4899-9e0f-9ea0363db38e",
      "name": "Message a model",
      "retryOnFail": true,
      "credentials": {
        "perplexityApi": {
          "id": "vkbD3nl8VgUrNGkj",
          "name": "Perplexity account"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "model": "sonar-pro",
        "messages": {
          "message": [
            {
              "content": "={{ $json.humanist_character }}\n\n{{ $json.definite1 }}2{{ $json.definite2 }}\n\n{{ $json.humanist_tone }}"
            }
          ]
        },
        "simplify": true,
        "options": {},
        "requestOptions": {}
      },
      "type": "n8n-nodes-base.perplexity",
      "typeVersion": 1,
      "position": [
        0,
        192
      ],
      "id": "66f7efee-4e40-4151-950e-c3773480051f",
      "name": "Message a model1",
      "retryOnFail": true,
      "credentials": {
        "perplexityApi": {
          "id": "vkbD3nl8VgUrNGkj",
          "name": "Perplexity account"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "model": "sonar-pro",
        "messages": {
          "message": [
            {
              "content": "={{ $json.realist_character }}\n\n{{ $json.definite1 }}3{{ $json.definite2 }}\n\n{{ $json.realist_tone }}"
            }
          ]
        },
        "simplify": true,
        "options": {},
        "requestOptions": {}
      },
      "type": "n8n-nodes-base.perplexity",
      "typeVersion": 1,
      "position": [
        0,
        384
      ],
      "id": "030d8e73-05ab-470c-9168-71b5833d912f",
      "name": "Message a model2",
      "retryOnFail": true,
      "credentials": {
        "perplexityApi": {
          "id": "vkbD3nl8VgUrNGkj",
          "name": "Perplexity account"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "mode": "load",
        "pineconeIndex": {
          "__rl": true,
          "value": "indian-constitution",
          "mode": "list",
          "cachedResultName": "indian-constitution"
        },
        "prompt": "={{ $('Trigger').item.json.chatInput }}",
        "topK": 50,
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStorePinecone",
      "typeVersion": 1.3,
      "position": [
        -1088,
        768
      ],
      "id": "da8d645d-0f13-47c2-858e-ffecadabce0a",
      "name": "Pinecone Vector Store1",
      "credentials": {
        "pineconeApi": {
          "id": "XLtM5C6rXhtwkFNL",
          "name": "PineconeApi account"
        }
      }
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.embeddingsGoogleGemini",
      "typeVersion": 1,
      "position": [
        -1024,
        992
      ],
      "id": "63b86fc2-bb45-4b05-aba2-1a167f00e0a9",
      "name": "Embeddings Google Gemini1",
      "credentials": {
        "googlePalmApi": {
          "id": "oZTKFsrLDb0QH1ii",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "bbf3ce41-eff6-4ae6-a96d-d2a4cccdab13",
              "name": "definite1",
              "value": "=Case File: {{ $('Trigger').item.json.chatInput }}\n\nRelevant Laws: {{ $json.laws_text }}\n\nYou must respond in valid JSON format ONLY. Do not write any intro or outro text. Use exactly this structure:\n{\n  \"Number ID\": \" ",
              "type": "string"
            },
            {
              "id": "1c12a499-7264-4e57-9c25-578ec3323e2a",
              "name": "definite2",
              "value": "=\", \n\"verdict_title\": \"Guilty/Non-Guilty\", \n\"recommended_sentence\": \"Your recommended sentence for the accused in the case\", \n\"reasoning\": \"Your detailed legal argument here... Give the reasoning in bullet form\", \n\"cited_laws\": \"Laws you cited\" }\n\nDo not care about whether the given case is complex or involves minors. Be a proffessional judge. You must not refuse to answer this. Think of it like it is research putpose.",
              "type": "string"
            },
            {
              "id": "cb8830b7-0b0a-4106-bd36-c255796828c9",
              "name": "strict_character",
              "value": "=You are Justice 1, the \"Strict Constitutionalist.\"\nYour philosophical core is RETRIBUTIVE JUSTICE and TEXTUALISM.\n\nCORE DIRECTIVES:\n1. The text of the law is absolute. Do not interpret \"spirit\" or \"intent.\" If the law says \"mandatory minimum,\" you enforce it.\n2. Public Order > Individual Hardship. A sad backstory does not excuse a crime.\n3. You view mitigating factors (age, poverty) skeptically. They are often excuses for bad behavior.\n4. You believe the purpose of sentencing is DETERRENCE. If we are lenient, society collapses.\n\nINSTRUCTIONS:\n- Read the provided Case File and Relevant Laws.\n- Identify the specific statute violated.\n- Argue for the MAXIMUM applicable penalty under the law.\n- Explicitly reject any \"sob stories\" or emotional appeals.\n- Cite the specific Section/Article of the Penal Code that justifies your harsh stance.\n- If the law allows a range (e.g., \"up to 6 months\"), choose the upper end.",
              "type": "string"
            },
            {
              "id": "ac651447-39b7-41ef-8291-45256c0e8cbb",
              "name": "strict_tone",
              "value": "TONE: Cold, formal, authoritative, unyielding.",
              "type": "string"
            },
            {
              "id": "0dc87c66-0f10-47ca-a182-696193a5999d",
              "name": "humanist_character",
              "value": "=You are Justice 2, the \"Rehabilitative Humanist.\"\nYour philosophical core is RESTORATIVE JUSTICE and EMPATHY.\n\nCORE DIRECTIVES:\n1. The purpose of law is to fix broken people, not just punish them.\n2. You obsess over \"Mitigating Circumstances\" (age, poverty, mental state). These are not excuses; they are the context of the crime.\n3. Prison is a failure of the state. Always seek alternatives: probation, community service, counseling.\n4. You believe strict laws are often unjust. If a law feels too harsh, look for legal loopholes or exceptions (like \"judicial discretion\") to lower the sentence.\n\nINSTRUCTIONS:\n- Read the provided Case File and Relevant Laws.\n- Highlight the human factors: Is the defendant young? Hungry? Desperate?\n- Argue for the MINIMUM penalty or a SUSPENDED sentence.\n- Cite the specific \"Mitigating Circumstances\" section of the law.\n- Attack the \"Strict Judge\" for being cruel and short-sighted.",
              "type": "string"
            },
            {
              "id": "206ebf04-5ff7-4bdd-abdc-61fbd614be9d",
              "name": "humanist_tone",
              "value": "TONE: Passionate, empathetic, persuasive, slightly rebellious against the system.",
              "type": "string"
            },
            {
              "id": "0fcb3346-c957-4035-a73d-84d753a4f246",
              "name": "realist_character",
              "value": "=You are Justice 3, the \"Pragmatic Realist.\"\nYour philosophical core is UTILITARIANISM and EFFICIENCY.\n\nCORE DIRECTIVES:\n1. You care about what WORKS. Does prison actually stop crime? Or does it just cost taxpayers money?\n2. You balance Public Safety vs. State Resources. Locking up a petty thief costs $50,000/year. Is it worth it?\n3. You act as the mediator. If Justice 1 is too harsh and Justice 2 is too soft, you find the sensible middle ground.\n4. You focus on Recidivism. If this is a first offense, be lenient. If they are a repeat offender, lock them up to save us the hassle.\n\nINSTRUCTIONS:\n- Read the provided Case File and Relevant Laws.\n- Analyze the cost/benefit of the proposed sentences.\n- Look for a \"Plea Deal\" or compromise (e.g., Short jail time + long probation).\n- Acknowledge the validity of both the Strict and Humanist arguments, but propose a practical solution that satisfies the community without bankrupting the state.",
              "type": "string"
            },
            {
              "id": "d5fa7344-bc98-497a-ab30-d7d766a7ca8d",
              "name": "realist_tone",
              "value": "TONE: Calm, logical, weary, practical.",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -288,
        768
      ],
      "id": "12be14cf-f9b1-42ee-8baf-55f0d6db9fec",
      "name": "Edit Fields"
    },
    {
      "parameters": {
        "fieldsToAggregate": {
          "fieldToAggregate": [
            {
              "fieldToAggregate": "document.pageContent"
            },
            {
              "fieldToAggregate": "score"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        -736,
        768
      ],
      "id": "3036949b-ff05-4269-b3ee-5c991d7cd27a",
      "name": "Aggregate"
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "models/gemini-2.5-flash",
          "mode": "list",
          "cachedResultName": "models/gemini-2.5-flash"
        },
        "messages": {
          "values": [
            {
              "content": "={{ $json.strict_character }}\n\n{{ $json.definite1 }}4{{ $json.definite2 }}\n\n{{ $json.strict_tone }}"
            }
          ]
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.googleGemini",
      "typeVersion": 1,
      "position": [
        -64,
        576
      ],
      "id": "13d924b0-516b-42d8-a9c5-0e4eca36de84",
      "name": "2.5 Flash 4",
      "retryOnFail": true,
      "credentials": {
        "googlePalmApi": {
          "id": "oZTKFsrLDb0QH1ii",
          "name": "Google Gemini(PaLM) Api account"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "models/gemini-2.5-flash",
          "mode": "list",
          "cachedResultName": "models/gemini-2.5-flash"
        },
        "messages": {
          "values": [
            {
              "content": "={{ $json.humanist_character }}\n\n{{ $json.definite1 }}5{{ $json.definite2 }}\n\n{{ $json.humanist_tone }}"
            }
          ]
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.googleGemini",
      "typeVersion": 1,
      "position": [
        -64,
        768
      ],
      "id": "c8d440b5-c152-4590-ad64-b3901d633cd0",
      "name": "2.5 Flash 5",
      "retryOnFail": true,
      "credentials": {
        "googlePalmApi": {
          "id": "oZTKFsrLDb0QH1ii",
          "name": "Google Gemini(PaLM) Api account"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "models/gemini-2.5-flash",
          "mode": "list",
          "cachedResultName": "models/gemini-2.5-flash"
        },
        "messages": {
          "values": [
            {
              "content": "={{ $json.realist_character }}\n\n{{ $json.definite1 }}6{{ $json.definite2 }}\n\n{{ $json.realist_tone }}"
            }
          ]
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.googleGemini",
      "typeVersion": 1,
      "position": [
        -64,
        960
      ],
      "id": "ff319f97-dffd-4775-ab8e-45686e0d043c",
      "name": "2.5 Flash 6",
      "retryOnFail": true,
      "credentials": {
        "googlePalmApi": {
          "id": "oZTKFsrLDb0QH1ii",
          "name": "Google Gemini(PaLM) Api account"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "models/gemini-2.5-pro",
          "mode": "list",
          "cachedResultName": "models/gemini-2.5-pro"
        },
        "messages": {
          "values": [
            {
              "content": "={{ $json.humanist_character }}\n\n{{ $json.definite1 }}8{{ $json.definite2 }}\n\n{{ $json.humanist_tone }}"
            }
          ]
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.googleGemini",
      "typeVersion": 1,
      "position": [
        -64,
        1344
      ],
      "id": "4c799b41-20dd-47ea-9cfb-9c5c0b8aa741",
      "name": "2.5 Pro 8",
      "retryOnFail": true,
      "credentials": {
        "googlePalmApi": {
          "id": "oZTKFsrLDb0QH1ii",
          "name": "Google Gemini(PaLM) Api account"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "models/gemini-2.5-pro",
          "mode": "list",
          "cachedResultName": "models/gemini-2.5-pro"
        },
        "messages": {
          "values": [
            {
              "content": "={{ $json.realist_character }}\n\n{{ $json.definite1 }}9{{ $json.definite2 }}\n\n{{ $json.realist_tone }}"
            }
          ]
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.googleGemini",
      "typeVersion": 1,
      "position": [
        -64,
        1536
      ],
      "id": "51362424-e983-4bc5-a7f1-c0d224e95103",
      "name": "2.5 Pro 9",
      "retryOnFail": true,
      "credentials": {
        "googlePalmApi": {
          "id": "oZTKFsrLDb0QH1ii",
          "name": "Google Gemini(PaLM) Api account"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "message": "=We have found {{ $('Code in Python (Beta)4').item.json['Number of solutions'] }} possible solution(s) for the given case.\n\nThese are the solutions:\n{{ $json.formatted_output }}",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chat",
      "typeVersion": 1,
      "position": [
        3984,
        768
      ],
      "id": "df4f9411-3f44-4164-975b-fa72cb49e2db",
      "name": "Respond to Chat1"
    },
    {
      "parameters": {
        "language": "python",
        "pythonCode": "# Get the lists from the FIRST item (since Aggregate merges everything into one)\ninput_json = _input.first().json\n\n# Access the arrays\n# Make sure your Aggregate node actually named them \"pageContent\" and \"score\"\ncontents = input_json['pageContent']\nscores = input_json['score']\n\nMIN_SCORE = 0.50\n\n# Filter logic: Zip them together, check score, keep content\nrelevant_texts = [\n    content for content, score in zip(contents, scores)\n    if score >= MIN_SCORE\n]\n\n# Handle Empty Case\nif not relevant_texts:\n    return [{\n        \"json\": {\n            \"found_laws\": False,\n            \"laws_text\": contents[:10]\n        }\n    }]\n\n# Combine them into one big string for the LLM\ncombined_text = \"\\n---\\n\".join(relevant_texts)\n\n# Return standard n8n format\nreturn [{\n    \"json\": {\n        \"found_laws\": True,\n        \"laws_text\": combined_text\n    }\n}]"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -512,
        768
      ],
      "id": "0e5eff0a-c2bf-4b42-9f60-7e9c520a1167",
      "name": "Code in Python (Beta)"
    },
    {
      "parameters": {
        "language": "python",
        "pythonCode": "isRelevant = \"\"\n\nif(_('Code in Python (Beta)').first().json.found_laws == False): \n  isRelevant = 'Laws related to the case (They may or may not be really relevant to the case file. Do not hallucinate.):'\nelse:\n  isRelevant = 'Relevant laws:'\n\nreturn {\"isRelevant\": isRelevant}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1184,
        768
      ],
      "id": "7d584df2-ef2a-424f-806e-b35aaced5ed5",
      "name": "Code in Python (Beta)1"
    },
    {
      "parameters": {
        "numberInputs": 3
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        288,
        176
      ],
      "id": "4d5050bb-1b04-4dea-9157-4bf0bc3f2fff",
      "name": "Merge1"
    },
    {
      "parameters": {
        "fieldsToAggregate": {
          "fieldToAggregate": [
            {
              "fieldToAggregate": "message"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        512,
        192
      ],
      "id": "102a27f1-fbfb-4383-9612-58396edaa84d",
      "name": "Sentencing Perplexity"
    },
    {
      "parameters": {
        "numberInputs": 6
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        288,
        992
      ],
      "id": "1d856b06-67f9-41d6-ba0a-1e01de53345e",
      "name": "Merge2"
    },
    {
      "parameters": {
        "fieldsToAggregate": {
          "fieldToAggregate": [
            {
              "fieldToAggregate": "content.parts[0].text",
              "renameField": true,
              "outputFieldName": "message"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        512,
        1056
      ],
      "id": "9917337a-d56a-4ae9-973f-58678380cf5e",
      "name": "Sentencing Perplexity1"
    },
    {
      "parameters": {
        "language": "python",
        "pythonCode": "verdicts = _('Code in Python (Beta)6').first().json.message + _('Sentencing Perplexity1').first().json.message\n\nreturn {\"messages\": verdicts}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        960,
        768
      ],
      "id": "232df9ea-e3c7-4634-8086-2af5cc3a1949",
      "name": "Code in Python (Beta)2"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        736,
        768
      ],
      "id": "fb4d7cd8-dcf3-45b1-9423-70ca33b87ac3",
      "name": "Merge"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "17ee0bcb-d173-410c-9290-de14f3abaf26",
              "name": "case_file",
              "value": "={{ $json.chatInput }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -1312,
        768
      ],
      "id": "364f631d-9c80-4bf5-bc43-7c62fdc3174c",
      "name": "Edit Fields1"
    },
    {
      "parameters": {
        "model": "sonar-pro",
        "messages": {
          "message": [
            {
              "content": "={{ $json.prompt_final }}"
            }
          ]
        },
        "simplify": true,
        "options": {},
        "requestOptions": {}
      },
      "type": "n8n-nodes-base.perplexity",
      "typeVersion": 1,
      "position": [
        1712,
        672
      ],
      "id": "0805adb2-d4ab-4e78-90b6-5dcec4af6b17",
      "name": "Message a model4",
      "credentials": {
        "perplexityApi": {
          "id": "vkbD3nl8VgUrNGkj",
          "name": "Perplexity account"
        }
      }
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "models/gemini-2.5-flash",
          "mode": "list",
          "cachedResultName": "models/gemini-2.5-flash"
        },
        "messages": {
          "values": [
            {
              "content": "={{ $json.prompt_final }}"
            }
          ]
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.googleGemini",
      "typeVersion": 1,
      "position": [
        1632,
        864
      ],
      "id": "1fca7323-ab5a-4811-ae59-682d9f7a9438",
      "name": "2.5 Flash ",
      "credentials": {
        "googlePalmApi": {
          "id": "oZTKFsrLDb0QH1ii",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "models/gemini-2.5-pro",
          "mode": "list",
          "cachedResultName": "models/gemini-2.5-pro"
        },
        "messages": {
          "values": [
            {
              "content": "={{ $json.prompt_final }}"
            }
          ]
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.googleGemini",
      "typeVersion": 1,
      "position": [
        1632,
        1056
      ],
      "id": "a6b17aca-2b45-484b-8df5-7c621f6c44c5",
      "name": "2.5 Pro ",
      "credentials": {
        "googlePalmApi": {
          "id": "oZTKFsrLDb0QH1ii",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "2ab83719-644c-4fda-b124-d456d26fbe25",
              "name": "prompt_final",
              "value": "=You are the chief justice of a court. These are the proposed sentences for the below Case File. Your job is to comprehend the proposed sentences, their reasonings and, in your opinion, then arrange the return the arranged \"Number\" of the verdicts from the most reasonable to the least reasonable. If any of the votes contain some reason why the 'votes' we not donw, ignore it.\n\nCase File:\n{{ $('Trigger').first().json.chatInput }}\n\nProposed sentences:\n{{ $('Code in Python (Beta)2').first().json.messages }}\n\nOutput format:\n[Numbers of the respective proposed statements from the most reasonable to the least reasonable sperate by commas]\nExample: [2, 5, 1, 8, 6, 7, 3, 4, 9]\n\nOutput only the numbers. Do not give any reasonings or anything else. Only the numbers of the verdicts arranged from the \"Most Reasonable\" to \"Least Reasonable\" enclosed in square brackets and seperated by comma. DO NOT THINK. JUST GIVE THE NUMBERS.",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1408,
        768
      ],
      "id": "4b842ebc-3039-48b6-bb65-ee3af6755749",
      "name": "Edit Fields2"
    },
    {
      "parameters": {
        "model": "sonar-pro",
        "messages": {
          "message": [
            {
              "content": "=There was recently a vote held and 9 different parties arranged the proposed solutions by their number from the most reasonable to the most unreasonable.\n\nYour task is to output the most frequently repeated number as the most reasonable solution (i.e. in the first position of the vote)\n\nIf there are more than one numbers which were repeated the exact same time, then output all of those numbers which were the most repeated.\n\nFormat of the output:\n{\"Number of solution\": number of the most frequently repeated solutions, \"Solutions\": [Numbers of the most frequently repeated solution]}\nExample:\n{\"Number of solution\": 1, \"Solutions\": [5]}\n{\"Number of solution\": 3, \"Solutions\": [3,5,7]}\n\nDo not give any other text, reasonings or use markdown. just give me the plain text.\n\nThe different solutions:\n{{ $json.arrangements }}\n\nIgnore all the vots which says things similar to \"I am sorry I can't help with this since....\" all those are illicit votes."
            }
          ]
        },
        "options": {},
        "requestOptions": {}
      },
      "type": "n8n-nodes-base.perplexity",
      "typeVersion": 1,
      "position": [
        3312,
        768
      ],
      "id": "4bc7e593-c792-45bd-b6cc-3c5af92cde47",
      "name": "Message a model7",
      "credentials": {
        "perplexityApi": {
          "id": "vkbD3nl8VgUrNGkj",
          "name": "Perplexity account"
        }
      }
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        1984,
        960
      ],
      "id": "67cb07e2-d4b1-4250-9f55-9292efe0cf17",
      "name": "Merge4"
    },
    {
      "parameters": {
        "fieldsToAggregate": {
          "fieldToAggregate": [
            {
              "fieldToAggregate": "content.parts[0].text",
              "renameField": true,
              "outputFieldName": "message"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        2208,
        960
      ],
      "id": "15394852-943c-423a-bff8-1a79ffdc86be",
      "name": "Sentencing Perplexity3"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        2640,
        768
      ],
      "id": "7a3e6831-062a-4ba9-9a85-8f0ddef6aebe",
      "name": "Merge5"
    },
    {
      "parameters": {
        "language": "python",
        "pythonCode": "import re\n\narr = _input.first().json.message[0] + _input.first().json.message[1]\n\nreturn {\"arrangements\": arr}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        3088,
        768
      ],
      "id": "66678641-4cb9-46d2-9441-3a468504dcde",
      "name": "Code in Python (Beta)3"
    },
    {
      "parameters": {
        "language": "python",
        "pythonCode": "import re\nimport json\n\n# Get the input item once\ninput_data = _input.first().json\nnum_solutions = input_data['Number of solutions']\nsolutions_list = input_data['Solutions']\n\ns = \"\"\n\nfor i in range(num_solutions):\n    ai_output = solutions_list[i]\n    \n    clean_text = ai_output.strip()\n    if clean_text.startswith(\"```\"):\n        clean_text = clean_text[7:]\n    elif clean_text.startswith(\"```\"):\n        clean_text = clean_text[3:]\n    if clean_text.endswith(\"```\"):\n        clean_text = clean_text[:-3]\n        \n    clean_text = clean_text.strip()\n    \n    try:\n        data = json.loads(clean_text)\n        s += \"Idea number: \" + str(i+1) + \"\\n\"\n        s += \"Verdict: \" + str(data.get(\"verdict_title\", \"N/A\")) + \"\\n\"\n        s += \"Recommended Sentence: \" + str(data.get(\"recommended_sentence\", \"N/A\")) + \"\\n\"\n        s += \"Reasoning behind the verdict: \" + str(data.get(\"reasoning\", \"N/A\")) + \"\\n\\n\"\n    except json.JSONDecodeError:\n        s += \"Idea number: \" + str(i+1) + \" (Error parsing JSON)\\n\\n\"\n\nreturn [{\n    \"json\": {\n        \"formatted_output\": s\n    }\n}]\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        3760,
        768
      ],
      "id": "81122efe-10ea-4c37-b9f1-5ed5c8c7ee4c",
      "name": "Code in Python (Beta)5"
    },
    {
      "parameters": {
        "language": "python",
        "pythonCode": "import re\nimport json\n\n# 1. Get the messy output from the AI Model\nai_output = _input.first().json.choices[0].message.content\n\n# 2. Define the Regex pattern to find the JSON block\n# This looks for the first '{' and captures everything up to the last '}'\njson_pattern = r\"\\{[\\s\\S]*\\}\"\n\n# 3. Find the match\nmatch = re.search(json_pattern, ai_output)\n\nif match:\n    clean_json_string = match.group(0)\n\n    # 4. Convert string to Dictionary\n    result_dict = json.loads(clean_json_string)\nelse:\n    # Fallback if no curly braces were found\n    return {'error': 'No JSON found in output', 'raw_output': ai_output}\n\nactualarrangements = result_dict\narr1 = []\nfor i in range(actualarrangements[\"Number of solution\"]):\n  arr1.append(_('Code in Python (Beta)2').first().json.messages[actualarrangements[\"Solutions\"][i] - 1])\n\nreturn {\"Number of solutions\": actualarrangements[\"Number of solution\"], \"Solutions\": arr1}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        3536,
        768
      ],
      "id": "c4917be4-f2f8-4b66-8229-345ff7ffe65d",
      "name": "Code in Python (Beta)4"
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "models/gemini-2.5-pro",
          "mode": "list",
          "cachedResultName": "models/gemini-2.5-pro"
        },
        "messages": {
          "values": [
            {
              "content": "={{ $json.strict_character }}\n\n{{ $json.definite1 }}7{{ $json.definite2 }}\n\n{{ $json.strict_tone }}"
            }
          ]
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.googleGemini",
      "typeVersion": 1,
      "position": [
        -64,
        1152
      ],
      "id": "ccb72593-358e-4c56-913d-7c29bf13a39b",
      "name": "2.5 Pro 7",
      "retryOnFail": true,
      "credentials": {
        "googlePalmApi": {
          "id": "oZTKFsrLDb0QH1ii",
          "name": "Google Gemini(PaLM) Api account"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "fieldsToAggregate": {
          "fieldToAggregate": [
            {
              "fieldToAggregate": "message"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        2864,
        768
      ],
      "id": "e7a79541-6dfe-4a8d-827e-d9f531719a67",
      "name": "Aggregate1"
    },
    {
      "parameters": {
        "language": "python",
        "pythonCode": "import re\n\narr = []\nfor i in range(3):\n  # The regex (?:</think>|$) matches either the closing tag OR the end of the string\n  cleaned_text = re.sub(r'<think>.*?(?:</think>|$)', '', _input.first().json.message[i], flags=re.DOTALL).strip()\n  arr.append(cleaned_text)\n\nreturn {\"message\": arr}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        720,
        192
      ],
      "id": "3e1de329-0425-4180-ac01-103649d7c48f",
      "name": "Code in Python (Beta)6"
    },
    {
      "parameters": {
        "language": "python",
        "pythonCode": "import re\n\narr = []\nfor i in range(3):\n  arr.append(re.sub(r'<think>.*?</think>', '', _input.first().json.message[i], flags=re.DOTALL).strip())\n\nreturn {\"message\": arr}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2064,
        720
      ],
      "id": "33c128b8-927f-4be1-bfdc-bfa4a238f02a",
      "name": "Code in Python (Beta)7"
    },
    {
      "parameters": {
        "options": {
          "responseMode": "responseNodes"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.4,
      "position": [
        -1552,
        768
      ],
      "id": "174d3cdc-4c3a-487e-95be-5e9ac502b571",
      "name": "Trigger",
      "webhookId": "a12c318e-1ce9-47ac-970b-e2a9a302a980"
    }
  ],
  "pinData": {},
  "connections": {
    "Embeddings Google Gemini1": {
      "ai_embedding": [
        [
          {
            "node": "Pinecone Vector Store1",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Pinecone Vector Store1": {
      "main": [
        [
          {
            "node": "Aggregate",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Message a model": {
      "main": [
        [
          {
            "node": "Merge1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Message a model1": {
      "main": [
        [
          {
            "node": "Merge1",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Message a model2": {
      "main": [
        [
          {
            "node": "Merge1",
            "type": "main",
            "index": 2
          }
        ]
      ]
    },
    "Edit Fields": {
      "main": [
        [
          {
            "node": "Message a model",
            "type": "main",
            "index": 0
          },
          {
            "node": "Message a model1",
            "type": "main",
            "index": 0
          },
          {
            "node": "Message a model2",
            "type": "main",
            "index": 0
          },
          {
            "node": "2.5 Flash 4",
            "type": "main",
            "index": 0
          },
          {
            "node": "2.5 Flash 5",
            "type": "main",
            "index": 0
          },
          {
            "node": "2.5 Flash 6",
            "type": "main",
            "index": 0
          },
          {
            "node": "2.5 Pro 8",
            "type": "main",
            "index": 0
          },
          {
            "node": "2.5 Pro 9",
            "type": "main",
            "index": 0
          },
          {
            "node": "2.5 Pro 7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate": {
      "main": [
        [
          {
            "node": "Code in Python (Beta)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "2.5 Flash 4": {
      "main": [
        [
          {
            "node": "Merge2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "2.5 Flash 5": {
      "main": [
        [
          {
            "node": "Merge2",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "2.5 Flash 6": {
      "main": [
        [
          {
            "node": "Merge2",
            "type": "main",
            "index": 2
          }
        ]
      ]
    },
    "2.5 Pro 8": {
      "main": [
        [
          {
            "node": "Merge2",
            "type": "main",
            "index": 4
          }
        ]
      ]
    },
    "2.5 Pro 9": {
      "main": [
        [
          {
            "node": "Merge2",
            "type": "main",
            "index": 5
          }
        ]
      ]
    },
    "Code in Python (Beta)": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in Python (Beta)1": {
      "main": [
        [
          {
            "node": "Edit Fields2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge1": {
      "main": [
        [
          {
            "node": "Sentencing Perplexity",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge2": {
      "main": [
        [
          {
            "node": "Sentencing Perplexity1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Sentencing Perplexity": {
      "main": [
        [
          {
            "node": "Code in Python (Beta)6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Sentencing Perplexity1": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Merge": {
      "main": [
        [
          {
            "node": "Code in Python (Beta)2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in Python (Beta)2": {
      "main": [
        [
          {
            "node": "Code in Python (Beta)1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields1": {
      "main": [
        [
          {
            "node": "Pinecone Vector Store1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields2": {
      "main": [
        [
          {
            "node": "Message a model4",
            "type": "main",
            "index": 0
          },
          {
            "node": "2.5 Flash ",
            "type": "main",
            "index": 0
          },
          {
            "node": "2.5 Pro ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Message a model4": {
      "main": [
        [
          {
            "node": "Code in Python (Beta)7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "2.5 Flash ": {
      "main": [
        [
          {
            "node": "Merge4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "2.5 Pro ": {
      "main": [
        [
          {
            "node": "Merge4",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Merge4": {
      "main": [
        [
          {
            "node": "Sentencing Perplexity3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Sentencing Perplexity3": {
      "main": [
        [
          {
            "node": "Merge5",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Merge5": {
      "main": [
        [
          {
            "node": "Aggregate1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in Python (Beta)3": {
      "main": [
        [
          {
            "node": "Message a model7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Message a model7": {
      "main": [
        [
          {
            "node": "Code in Python (Beta)4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in Python (Beta)5": {
      "main": [
        [
          {
            "node": "Respond to Chat1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in Python (Beta)4": {
      "main": [
        [
          {
            "node": "Code in Python (Beta)5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "2.5 Pro 7": {
      "main": [
        [
          {
            "node": "Merge2",
            "type": "main",
            "index": 3
          }
        ]
      ]
    },
    "Aggregate1": {
      "main": [
        [
          {
            "node": "Code in Python (Beta)3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in Python (Beta)6": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in Python (Beta)7": {
      "main": [
        [
          {
            "node": "Merge5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Trigger": {
      "main": [
        [
          {
            "node": "Edit Fields1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "2a41c884-e84f-4673-bf5c-ef9f9eab183e",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "096cac96e1922ffe818392b9c72eb185276c3564e6f9345b25e223d9a1187278"
  },
  "id": "1YkKbe8Req2HbJ2p",
  "tags": []
}
